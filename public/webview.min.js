/*! 06-24-2018 */

function extractPageText(a,b){for(var c=[].slice.call(a.body.childNodes),d=[];c.length;){var e=c[0];if(c.shift(),!e.matches||!e.matches('link, style, script, noscript, .hidden, .visually-hidden, .visuallyhidden, [role=presentation], [hidden], [style*="display:none"], [style*="display: none"], .ad, .dialog, .modal, select, svg'))if(3!==e.nodeType)for(var f=e.childNodes,g=f.length,h=0;h<g;h++){var i=f[h];3===i.nodeType?d.push(i):c.unshift(i)}else d.push(e)}for(var j="",k=d.length,h=0;h<k;h++)j+=d[h].textContent+" ";var l=a.head.querySelector("meta[name=description]");return l&&(j+=" "+l.content),j=j.trim(),j=j.replace(/[\n\t]/g,""),j=j.replace(/\s{2,}/g," ")}function getPageData(){var a,b,c,d,e=document.querySelector("[itemprop=price], .price, .offer-price, #priceblock_ourprice, .discounted-price"),f=document.querySelector("[itemprop=priceCurrency], [property=priceCurrency]");e&&(a=e.textContent),/\d/g.test(a)||(a=void 0),a&&-1===a.indexOf("$")&&f&&"en-US"===navigator.language&&(a=(f.content||f.textContent).replace("USD","$")+a);var g=document.querySelector('.star-img, .rating, [itemprop="ratingValue"], [property="ratingValue"]');g||(g=document.querySelector('[class^="rating"], [class^="review"]')),g&&(b=g.title||g.alt||g.content||g.textContent,(b=b.replace("rating","").replace("stars","").replace("star","").trim())&&/\d+$/g.test(b)&&(b+=" stars"));var h=document.querySelector('[itemprop="location"], [itemprop="address"]');if(!h)var h=document.querySelector(".adr, .addr, .address");h&&(c=h.textContent.trim()),c&&/,?\d{5}$/g.test(c)&&(c=c.replace(/,?\d{5}$/g,""));var i=document.querySelector('[itemprop="totalTime"], [itemprop="cookTime"]');i&&(d=i.textContent,d=d.replace(/\sm$/g," minutes").replace(/\sh$/g," hours"),d=d.replace("1 hours","1 hour"));for(var j=extractPageText(document,window),k=document.querySelectorAll("iframe");0<k.length;k++)try{j+=". "+extractPageText(k[0].contentDocument,k[0].contentWindow)}catch(a){}return j=j.substring(0,3e5),{extractedText:j,metadata:{price:a,rating:b,location:c,cookTime:d}}}function checkDoc(){"complete"===document.readyState?ipc.sendToHost("pageData",getPageData()):setTimeout(checkDoc,500)}function debugPhishing(a){phishingDebugMessages.push(a)}function checkPhishingStatus(){function a(a){c.lastIndex=0;var b=a.split(".");return c.test(a)?b.slice(-2).join("."):b.slice(-3).join(".")}if(!document.querySelector("input[type=password], form"))return!1;var b=performance.now(),c=/\.(com|net|org|edu|gov|mil)$/g;document.querySelector("input[type=password]")&&(debugPhishing("found password input, resetting minScore"),j=.9);for(var d=["secure","account","webscr","login","ebayisapi","signing","banking","confirm"],e=["password","creditcard","credit card","security code","expiration date","card type","social security","income tax","date of birth","joint return"],f=["adobeid-na1.services.adobe.com","www.zdnet.com","www.discover.com"],g=0;g<f.length;g++)if(f[g]===window.location.hostname)return void debugPhishing("domain is whitelisted, not checking");var h=window.location.toString(),i=(document.body.textContent,document.body.innerHTML),j=1.35,k=0,l=document.createElement("a");doubleDomainRegex.test(window.location.hostname)&&(debugPhishing("found misleading domain"),k+=.0075*window.location.toString().length),"https:"!==window.location.protocol&&"file:"!==window.location.protocol&&(debugPhishing("no https"),k+=.15,"data:"===window.location.protocol&&(debugPhishing("data: protocol found"),k+=.25)),window.location.host.length>25&&(debugPhishing("long hostname detected"),k+=.0075*window.location.host.length),h.split("?")[0].length>75&&(debugPhishing("long window location detected"),k+=Math.min(1e-4*window.location.toString().length,.2)),h.split("#")[0].split("/").length>6&&(debugPhishing("long path found: "+h),k+=Math.max(Math.min(.05*h.split("/").length,.75),.25)),window.location.hostname.replace("www.","").split(".").length>3&&window.location.hostname.length>20&&(debugPhishing("high number of . characters detected"),k+=Math.min(.03*h.split("?")[0].split(".").length,.2)),window.location.pathname.length>25&&(debugPhishing("paths detected"),k+=Math.min(.05+.002*window.location.pathname.length,.25)),o&&window.location.pathname.length<20&&window.location.hostname.replace("www.","").length<18&&(debugPhishing("short root domain found, increasing minScore"),j+=.3+.05*(18-window.location.hostname.length)-.01*window.location.pathname.length);var m=["com","org","edu","mil","gov","io"],n=window.location.hostname.split(".").reverse()[0],o=-1!==m.indexOf(n);window.location.hostname&&!o&&(k+=.15,debugPhishing("unusual domain ending found, increasing score")),d.forEach(function(a){-1!==h.toLowerCase().indexOf(a)&&(debugPhishing("detected sensitive word found in location"),k+=.025)});var p=document.querySelectorAll("form"),q=0,r=!1,s=!1,t=!1,u=!1;if(p){for(var g=0;g<p.length;g++){var v=p[g];v.innerHTML.toLowerCase();if(function(a){if(a.querySelector("input[type=password]"))return debugPhishing("form with password input found"),u=!0,!0;if(2===a.querySelectorAll("input[type=text], input[type=password]").length)return debugPhishing("possibly sensitive form, checking but increasing minScore"),j*=1.5,u=!0,!0;if(!a.querySelector("input"))return debugPhishing("empty form found, checking but not counting as sensitive"),j+=.35,!0;for(var b=a.textContent.toLowerCase(),c=0;c<e.length;c++)if(-1!==b.indexOf(e[c]))return debugPhishing("sensitive word found in form, checking"),u=!0,j+=.075,!0;return!1}(v)){var w=v.getAttribute("action");if(w&&-1===h.split("?")[0].indexOf(w.split("?")[0])){q+=v.innerHTML.length,(v.getAttribute("onsubmit")&&"return false"!==v.getAttribute("onsubmit")||v.getAttribute("onkeydown")||v.getAttribute("onkeypress")||v.getAttribute("onkeyup"))&&(debugPhishing("js html inline attributes detected"),k+=.05);var x=w.replace(window.location.toString(),"").replace(window.location.pathname,"").split("/").length-1;0!==w.indexOf("javascript:")&&x<2?s=!0:x<3&&(debugPhishing("non-absolute form path detected"),k+=.1),-1!==w.indexOf(".php")&&(debugPhishing("php file action found"),k+=.075),l.href=w,0!==w.indexOf("javascript:")&&function(a,b){return a!==b&&!b.endsWith("."+a)}(a(window.location.hostname),a(l.hostname))&&(debugPhishing("submitting form to xdomain"),k+=.7),"https:"!==l.protocol&&(t=!0)}else r=!0}}!0===r&&(debugPhishing("form without action detected"),k+=.3,k+=Math.min(.2,1e-4*q)),!0===s&&(debugPhishing("form with simple path for action detected"),k+=.75),t&&(debugPhishing("submitting form without https"),k+=.15)}u||document.querySelector("input[type=password]")||(debugPhishing("no sensitive forms found, increasing minScore"),j+=.5);for(var y=document.querySelectorAll("a, area[href]"),z={},A={},B=0,C=0,g=0;g<y.length;g++){var D=y[g].getAttribute("href");D&&("#"!==D||y[g].onclick)?(0===D.indexOf("javascript:")&&C++,l.href=y[g].href,z[l.host]=z[l.host]+1||1,A[D]=A[D]+1||1):B++}var E=0,F=0,G=a(window.location.host);for(var H in z)if(F+=z[H],a(H)!==G){if(z[H]>4&&H&&z[H]/F>.25){debugPhishing("found "+z[H]+" links that point to domain "+H),k+=Math.min(.1*z[H],.25);break}}else E+=z[H];(F>2&&0===E||F>5&&E/F<.15)&&(debugPhishing("links go to external domain"),k+=Math.min(.1+.1*(F-E),.5)),(B>9||F>2&&B/F>.5)&&(debugPhishing("counted "+B+" empty links"),k+=Math.min(.02*B,.2)),C>3&&(debugPhishing("counted "+C+" javascript links"),k+=.1);var I=i.length;q>50&&q<1e3&&q/I<.075?(debugPhishing("forms are very minor part of page, increasing minScore"),j+=Math.min(1.15-q/I,1.2)):q>50&&q<3500&&q/I<.14&&(debugPhishing("forms are minor part of page, increasing minScore (small)"),debugPhishing(q),debugPhishing(I),j+=.25);var J=document.querySelectorAll("script"),K={},L=0;if(J)for(var g=0;g<J.length;g++)if(J[g].src){l.href=J[g].src;var M=l.hostname;K[M]=K[M]+1||1,L++}for(var N in K)K[N]>2&&K[N]/L>.75&&K[N]<.95&&(k+=.1,debugPhishing("external scripts found, increasing score")),K[N];p.length>3&&(debugPhishing("many forms found, increasing minScore"),j+=Math.min(.05*p.length,.2)),document.body.innerHTML.length<4500&&(debugPhishing("small amount of body text, multiplying score"),k*=1.4);var O=document.querySelector('link[rel="shortcut icon"]');O&&O.href&&(l.href=O.href,a(l.hostname)!==G&&(debugPhishing("icon from external domain found"),k+=.1));var P=document.querySelectorAll("p");return P.length>50&&(debugPhishing("many paragraphs found, increasing minScore"),j+=.1+Math.min(.025*P.length,.25)),debugPhishing("min "+j),debugPhishing("status "+k),k>j&&ipc.sendToHost("phishingDetected",phishingDebugMessages),debugPhishing("phishing scan took "+(performance.now()-b)+" milliseconds"),!0}function pageIsReaderable(){var a=new Map,b=document.querySelectorAll("p"),c=0;if(!b)return!1;for(var d=0;d<b.length;d++){var e=Math.max(b[d].textContent.length-100,-30);c+=e;var f=a.get(b[d].parentNode)||0;a.set(b[d].parentNode,f+e)}var g=0;return a.forEach(function(a,b){a>g&&(g=a)}),!!(g>400&&g/c>.33||g>200&&document.querySelector('article, meta[property="og:type"][content="article"]'))}function isScrolledIntoView(a){var b=a.getBoundingClientRect().top,c=a.getBoundingClientRect().bottom;return b<window.innerHeight&&c>=0}var electron=require("electron"),ipc=electron.ipcRenderer;window.chrome={},setTimeout(checkDoc,500);var phishingDebugMessages=[],doubleDomainRegex=/[^a-zA-Z]+(com|net|org|edu|gov|mil|uk|ca|jp|fr|au|us|ru|ch|it|nl|de|es)([^a-zA-Z][^\n]*)\.(com|net|org|edu|gov|mil|uk|ca|jp|fr|au|us|ru|ch|it|nl|de|es)/g,didCheckStatus=!1;if(window.addEventListener("load",function(){didCheckStatus=!0,setTimeout(checkPhishingStatus,1e3)}),document.addEventListener("DOMContentLoaded",checkPhishingStatus),setTimeout(function(){didCheckStatus||checkPhishingStatus()},2500),window.addEventListener("load",function(a){pageIsReaderable()&&(setTimeout(function(){ipc.sendToHost("canReader")},500),setTimeout(function(){ipc.sendToHost("canReader")},2500))}),ipc.on("getKeywordsData",function(a){function b(a){for(var b=["LINK","STYLE","SCRIPT","NOSCRIPT","svg","symbol","title","path","style"],c="",d=a.querySelectorAll("p, h2, h3, h4, li, [name=author], [itemprop=name], .article-author"),e=window.scrollY,f=0;f<d.length;f++){var g=d[f];if(!(!isScrolledIntoView(d[f])&&a===document||"META"===d[f].tagName&&e>500||d[f].textContent.length<100||d[f].querySelector("time, span, div, menu"))&&-1===b.indexOf(g.tagName)){var h=g.textContent||g.content;d[f-1]&&/\.\s*$/g.test(d[f-1].textContent)?c+=" "+h:c+=". "+h}}return c=c.replace(/[\n\t]/g,"")}if(pageIsReaderable()||-1!==window.location.toString().indexOf("reader/index.html")){var c=b(document),d=document.querySelectorAll("iframe");if(d)for(var e=0;e<d.length;e++)try{c+=" "+b(d[e].contentDocument)}catch(a){}var f=function(a){var b=a.split(/\s+/g);b=b.filter(function(a){return!!a});for(var c=[],d=["a","an","the","on","of","or","i"],e=[".","?","!"],f=[",",":",";","."],g=[],h=0;h<b.length;h++)if(b[h-1]&&b[h-1].length>1&&e.includes(b[h-1][b[h-1].length-1]))g=[];else if(b[h][0].toUpperCase()!==b[h][0]||!/[A-Z]/g.test(b[h][0])||(g.push(b[h]),b[h].length>1&&f.includes(b[h][b[h].length-1])))if(g.length>0&&d.includes(b[h].toLowerCase()))g.push(b[h]);else if(g.length>1){for(;d.includes(g[g.length-1].toLowerCase());)g.pop();g.length>1&&c.push(g.join(" ").replace(/^\W+/g,"").replace(/\W+$/g,"")),g=[]}else g=[];return c.slice(0,5)}(c);ipc.sendToHost("keywordsData",{entities:f})}}),"drive.google.com"===window.location.hostname){var realWindowOpen=window.open;window.open=function(a){return a?realWindowOpen(a):{document:new Proxy({},{get:function(){return function(){return document.createElement("div")}},set:function(){console.warn("unpatched set",arguments)}}),location:{replace:function(a){realWindowOpen(a)}}}}}"news.google.com"===window.location.hostname&&(window.open=null);